<!doctype html>
<html>
<head>
	<meta	charset="utf-8">
	<meta	http-equiv="X-UA-Compatible"	content="IE=edge,chrome=1">

	<title>Ops Suite One Display Control</title>
	<meta name="description"	content="A website for controlling the displays in Ops Suite 1">
	<meta name="author"	content="DD12">

	<meta name="viewport" content="width=device-width">
	<meta name="HandheldFriendly" content="True">

	<!--link rel="stylesheet" href="js/libs/jquery.mobile.structure-1.3.1.min.css"-->
	<link rel="stylesheet" href="os1.css">
	<link rel="stylesheet" href="numpad/numpad.css">
	<link rel="stylesheet" href="vsources/vsources.css">

</head>
<body>

<div id="vdest-cntnr-outer">
	<div id="vdest-cntnr-header" class="vdest-cntnr-brdr">
	</div>
	<img class="header-img" src="img/header1.png"> <!-- positioned absolutely and sized with javascript -->

	<div id="vdest-cntnr-destinations" class="vdest-cntnr-brdr">

		<div id="vdest-1" class="vdest vdest-bkg" data-output="1" data-name_of="Left TV">
			<img class="vdest-connto" src="img/transp.png">
			<img class="vdest-tvbtn-power" src="img/btn_power.png">
			<!-- <div class="vdest-tvbtn-mute vdest-tvbtn-brdr vdest-bkg"></div> -->
			<img class="vdest-tvbtn-cbox-clr vdest-tvbtn-cbox" src="img/cbox_clr.png">
		</div>

		<div id="vdest-2" class="vdest vdest-bkg" data-output="2" data-name_of = "Center TV A">
			<img class="vdest-connto" src="img/transp.png">
			<img class="vdest-tvbtn-power" src="img/btn_power.png">
			<img class="vdest-tvbtn-cbox-clr vdest-tvbtn-cbox" src="img/cbox_clr.png">
		</div>

		<div id="vdest-3" class="vdest vdest-bkg" data-output="3" data-name_of="Center TV B">
			<img class="vdest-connto" src="img/transp.png">
			<img class="vdest-tvbtn-power" src="img/btn_power.png">
			<img class="vdest-tvbtn-cbox-clr vdest-tvbtn-cbox" src="img/cbox_clr.png">
		</div>

		<div id="vdest-4" class="vdest vdest-bkg" data-output="4" data-name_of="Right TV A">
			<img class="vdest-connto" src="img/transp.png">
			<img class="vdest-tvbtn-power" src="img/btn_power.png">
			<img class="vdest-tvbtn-cbox-clr vdest-tvbtn-cbox" src="img/cbox_clr.png">
		</div>

		<div id="vdest-5" class="vdest vdest-bkg" data-output="5" data-name_of="Right TV B">
			<img class="vdest-connto" src="img/transp.png">
			<img class="vdest-tvbtn-power" src="img/btn_power.png">
			<img class="vdest-tvbtn-cbox-clr vdest-tvbtn-cbox" src="img/cbox_clr.png">
		</div>

		<div id="vdest-6" class="vdest vdest-bkg" data-output="6" data-name_of="Action Center TV">
			<img class="vdest-connto" src="img/transp.png">
			<img class="vdest-tvbtn-power" src="img/btn_power.png">
			<img class="vdest-tvbtn-cbox-clr vdest-tvbtn-cbox" src="img/cbox_clr.png">
		</div>

		<div class="vdest-hevs-cntnr">
			<div id="vdest-hevs1" class="vdest vdest-bkg" data-output="7" data-name_of="To MCC Video 1">
				<img class="vdest-connto vdest-connto-hevs" src="img/transp.png">
				<img class="vdest-tvbtn-cbox-clr vdest-tvbtn-cbox" src="img/cbox_clr.png">
			</div>

			<div id="vdest-hevs2" class="vdest vdest-bkg" data-output="8" data-name_of="To MCC Video 2">
				<img class="vdest-connto vdest-connto-hevs" src="img/transp.png">
				<img class="vdest-tvbtn-cbox-clr vdest-tvbtn-cbox" src="img/cbox_clr.png">
			</div>
		</div>

		<div class="vdest-btn-cntnr">
			<div class="vdest-btn-info vdest-btn vdest-bkg">
				<img class="btn" src="img/info.png">
				<span class="varitext-btn">Help</span>
			</div>
			<div class="vdest-btn-default vdest-btn vdest-bkg">
				<img class="btn" src="img/settings.png">
				<span class="varitext-btn">Default Configuration</span>
			</div>
			<div class="vdest-btn-numpad vdest-btn vdest-bkg">
				<img class="btn" src="vsources/img/tv.png">
				<span id="vdest-btn-chn-text" class="varitext-btn">Change TV Channel</span>
			</div>
<!--
			<div class="vdest-btn-powerall vdest-btn vdest-bkg">
				<img class="btn" src="img/btn_power.png">
				<span class="varitext-btn">Power Toggle - Front Five</span>
			</div>
 			<div class="vdest-btn-checkall vdest-btn vdest-bkg">
				<img class="cbox" src="img/cbox_chk.png">
				<span class="varitext-btn">Select Front Five</span>
			</div>
-->
			<div class="vdest-btn-clearall vdest-btn vdest-bkg">
				<img class="cbox" src="img/cbox_clr.png">
				<span class="varitext-btn">Clear All Selections</span>
			</div>
			<div class="vdest-btn-selected vdest-btn vdest-bkg">
				<img class="btn" src="img/cbox_chk.png">
				<span class="varitext-btn">Process Selected Devices:</span>
				<div class="vdest-btn-selected-devices">
				</div>
			</div>
		</div>
	</div>

	<div id="vdest-cntnr-footer" class="vdest-cntnr-brdr">
		<div id="vdest-status">&nbsp;</div>
	</div>

</div> <!-- outer -->


<script src="js/libs/jquery-1.7.2.min.js"></script>
<!--script src="/js/libs/jquery.mobile-1.3.1.min.js"></script-->
<!--script src="/js/libs/jquery-ui.min.js"></script-->
<!--script src="/js/libs/jquery.ui.touch-punch.min.js"></script-->
<script src="numpad/numpad.js"></script>
<script src="vsources/vsources.js"></script>


<script type="text/javascript">


var el_status = document.getElementById( "vdest-status" );
function status_set( msg )
{
	if( el_status )
	{
		el_status.innerHTML = msg || "Click on an output device or select the checkbox of devices to which to map an input source.";
	}
}

var os1_nav_is_mobile = ( /Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent) );


$(function()
{
	var height_body;
	var width_body;
	var oheight_header;
	var oheight_footer;
	var width_header_div;
	var $_vdest_single_selection = null;


	var $_vdestinations = new Array( $( "#vdest-1" ), $( "#vdest-2" ), $( "#vdest-3" ), $( "#vdest-4" ), $( "#vdest-5" ), $( "#vdest-6" ), $( "#vdest-hevs1" ), $( "#vdest-hevs2" ) );
	var $_vdest_cntnr = $( "#vdest-cntnr-destinations" );
	var $_vdest_btn_clearall = $_vdest_cntnr.find( ".vdest-btn-clearall" ); // the "clear all selections" button
	var $_vdest_btn_selected = $_vdest_cntnr.find( ".vdest-btn-selected" ); // the "process selected devices" button
	var vsource_is_showing = false; // When true, the vsource pop-up is active
	var numpad_is_showing = false; // When true, the numpad pop-up is active


	vsources_create( status_set, function() // called when input selector is closed
	{
		$_vdest_single_selection = null;
		vsource_is_showing = false;
	}, function( vol_level )  // called when volume or mute btns clicked
	{
		if( null !== $_vdest_single_selection )
		{
			if( vol_level === 0 )
				device_control_mute( $_vdest_single_selection );
			else device_control_volume( $_vdest_single_selection, vol_level );
		} else
		{
			for( var dx = 0; dx < $_vdestinations.length; dx++ )
			{
				if( true === $_vdestinations[dx].data("is_selected") )
				{
					if( vol_level === 0 )
						device_control_mute( $_vdestinations[dx] );
					else device_control_volume( $_vdestinations[dx], vol_level );
				}
			}
		}
	}, function() // called when power btn clicked
	{
		if( null !== $_vdest_single_selection )
		{
			device_control_power( $_vdest_single_selection );
		} else
		{
			for( var dx = 0; dx < $_vdestinations.length; dx++ )
			{
				if( true === $_vdestinations[dx].data("is_selected") )
					device_control_power( $_vdestinations[dx] );
			}
		}
	}, function( $_vsrc_clicked ) // called when source object is clicked
	{
		if( null !== $_vdest_single_selection )
		{
			source_destination_connection_set( $_vsrc_clicked, $_vdest_single_selection );
			device_control_switch( $_vsrc_clicked, $_vdest_single_selection );
			$_vdest_single_selection = null;
		} else
		{
			for( var dx = 0; dx < $_vdestinations.length; dx++ )
			{
				if( true === $_vdestinations[dx].data( "is_selected" ) )
				{
					vdest_cbox_uncheck( $_vdestinations[dx], null );
					source_destination_connection_set( $_vsrc_clicked, $_vdestinations[dx] );
					device_control_switch( $_vsrc_clicked, $_vdestinations[dx] );
				}
			}
			$_vdest_btn_selected_hide();
		}
		vsource_is_showing = false;
	}, function() // returns what is currently connected to the singly-selected destination
	{
		return (null !== $_vdest_single_selection) ? $_vdest_single_selection.data( "connected_to") : null;
	} );


	function vdest_btn_chn_text_set( chn )
	{
		$( "#vdest-btn-chn-text" ).html( "Change TV Channel" + ((chn.length > 0) ? (": <span style='color:green'>" + chn + "</span>") : "") ); // The text for the channel number button to show current channel number
	}

	numpad_create( function() // called when numpad is closed
	{
		numpad_is_showing = false;
	}, function( chan_text ) // called when a channel was entered
	{
		if( chan_text.charAt(0) === "+" )
		{
			device_control_tv_channel_bump( 1 );
		} else if( chan_text.charAt(0) === "-" )
		{
			device_control_tv_channel_bump( -1 );
		} else
		{
			device_control_tv_channel_set( chan_text );
		}
		vdest_btn_chn_text_set( chan_text );
	} );


	$(document).keyup( function( evt )
	{
		if( vsource_is_showing )
		{
			vsources_keyup( evt );
		} else if( numpad_is_showing )
		{
			numpad_keyup( evt );
		}
	} );


	function $_vdest_btn_selected_show()
	{
		var devices = "";
		for( var dx = 0; dx < $_vdestinations.length; dx++ )
		{
			if( true === $_vdestinations[dx].data( "is_selected" ) )
				devices += $_vdestinations[dx].data( "name_of" ) + "<br/>";
		}
		$_vdest_btn_selected.find( ".vdest-btn-selected-devices" ).html( devices );
		$_vdest_btn_selected.show( os1_nav_is_mobile ? 0 : 200 );
		$_vdest_btn_clearall.show();
	}

	function $_vdest_btn_selected_hide()
	{
		$_vdest_btn_selected.hide( os1_nav_is_mobile ? 0 : 200 );
		$_vdest_btn_clearall.hide();
	}


	function vdest_effect_set( $, new_class )
	{
		if( $ )
		{
			$.removeClass( "vdest-effect-none vdest-effect-click vdest-effect-hover vdest-effect-hover-btn vdest-effect-connected" );
			if( new_class )
				$.addClass( new_class );
		}
	}


	function source_destination_connection_set( $_src, $_dst )
	{
			// set the src to dest data connection reference and vice versa
		$_dst.data( "connected_to", $_src );
		$_src.data( "connected_to", $_dst );

		var $_connto = $_dst.find( ".vdest-connto" );
		var icon = $_src.attr( "src" );
		$_connto.attr( "src", icon );
		$_connto.addClass( "vdest-connto-brdr" );
	}


	var vdest_cbox_checked_count = 0;

	function vdest_cbox_check( $, $_cbox )
	{
		vdest_cbox_checked_count++;
		$.data( "is_selected", true );
		if( null === $_cbox )
			$_cbox = $.find( ".vdest-tvbtn-cbox" );
		$_cbox.attr( "src", "img/cbox_chk.png" );
	}
	function vdest_cbox_uncheck( $, $_cbox )
	{
		if( true === $.data( "is_selected" ) )
			vdest_cbox_checked_count--;
		if( vdest_cbox_checked_count < 0 ) // insurance
			vdest_cbox_checked_count = 0;
		$.data( "is_selected", false );
		if( null === $_cbox )
			$_cbox = $.find( ".vdest-tvbtn-cbox" );
		$_cbox.attr( "src", "img/cbox_clr.png" );
	}




	/*****************************************************************************
	 *****************************************************************************	O U T P U T   (D E S T I N A T I O N)   D I V
	 *****************************************************************************/


	function source_selection_show()
	{
		var a_hevs_is_selected = false;
		var headermsg = "";
		var n_checked = 0;
		var $_vsrc_connected_to = null;

		if( null !== $_vdest_single_selection )
		{
			headermsg = $_vdest_single_selection.data( "name_of" );

			var output = $_vdest_single_selection.data( "output" );
			if( (output === 7) || (output === 8) ) // hevs... must match the html "data-output"s above
				a_hevs_is_selected = true;

				// Highlight the source icon that the $_vdest_single_selection is connected to
			$_vsrc_connected_to = $_vdest_single_selection.data( "connected_to" );
		} else
		{
			for( var dx = 0; dx < $_vdestinations.length; dx++ )
			{
				if( true === $_vdestinations[dx].data("is_selected") )
				{
					n_checked++;
					headermsg += $_vdestinations[dx].data( "name_of" ) + ", ";
					if( dx >= 6 )
						a_hevs_is_selected = true;
				}
			}
			headermsg = headermsg.substring(0, headermsg.length - 2); // strip trailing ", "
		}


		vsources_show( headermsg, a_hevs_is_selected, $_vsrc_connected_to );
		vsource_is_showing = true;
	}//source_selection_show


	function vdest_btn_mouseenter( $, statmsg )
	{
		if ( !(vsource_is_showing || numpad_is_showing) )
		{
			$.css( "cursor", "pointer" );
			vdest_effect_set( $, "vdest-effect-hover-btn" );
			status_set( statmsg );
		}
	}
	function vdest_btn_mouseleave( $, statmsg )
	{
		if ( !(vsource_is_showing || numpad_is_showing) )
		{
			$.css( "cursor", "default" );
			vdest_effect_set( $, null );
			status_set( statmsg );
		}
	}
	function vdest_btn_mousedown( $ )
	{
		if ( !(vsource_is_showing || numpad_is_showing) )
		{
			vdest_effect_set( $, "vdest-effect-click" );
			$.css( "opacity", 0.3 );
		}
	}
	function vdest_btn_mouseup( $ )
	{
		if ( !(vsource_is_showing || numpad_is_showing) )
		{
			vdest_effect_set( $, "vdest-effect-hover" );
			$.css( "opacity", 1.0 );
		}
	}


	for( var dx = 0; dx < $_vdestinations.length; dx++ )
	{
		$_vdestinations[dx].data(
		{
			connected_to: null,
			is_selected: false
		} ).click( function()									/************* OUTPUT DEVICE CLICK ************/
		{
			if( vsource_is_showing || numpad_is_showing || (vdest_cbox_checked_count > 0) )
				return false;
			$_vdest_single_selection = $(this);
			vdest_effect_set( $(this), "vdest-effect-none" );
			source_selection_show();
			status_set( "Click to select an input source for '" + $(this).data("name_of") + "'." );
			return false;
		} ).mouseenter( function()
		{
			if( vsource_is_showing || numpad_is_showing )
				return false;
			$(this).css( "cursor", "pointer" );
			vdest_effect_set( $(this), "vdest-effect-hover" );
			status_set( "Click to select an input source for '" + $(this).data("name_of") + "'." );
			return false;
		} ).mouseleave( function()
		{
			if( vsource_is_showing || numpad_is_showing )
				return false;
			$(this).css( "cursor", "default" );
			status_set( null );
			vdest_effect_set( $(this), "vdest-effect-none" );
			return false;
		} );

		$_vdestinations[dx].find( ".vdest-tvbtn-power" ).click( function()							/************* OUTPUT DEVICE POWER BUTTON ************/
		{
			if( vsource_is_showing || numpad_is_showing )
				return false;
			device_control_power( $(this).parent() );
			return false;
		} ).mouseenter( function()
		{
			vdest_btn_mouseenter( $(this), "Click to cycle power on '" + $(this).parent().data( "name_of" ) + "'."  );
		} ).mouseleave( function()
		{
			vdest_btn_mouseleave( $(this), "Click to select an input source for '" + $(this).parent().data( "name_of" ) + "'." );
			// DO NOT: return false; the mouseleave needs to bubble up
		} ).mousedown( function()
		{
			vdest_btn_mousedown( $(this) );
			return false;
		} ).mouseup( function()
		{
			vdest_btn_mouseup( $(this) );
			return false;
		} );

		$_vdestinations[dx].find( ".vdest-tvbtn-cbox").click( function()					/************* OUTPUT DEVICE CHECKBOX ************/
		{
			if( vsource_is_showing || numpad_is_showing )
				return false;
			if( false === $(this).parent().data( "is_selected" ) )
			{
				vdest_cbox_check( $(this).parent(), $(this) );
			} else
			{
				vdest_cbox_uncheck( $(this).parent(), $(this) );
			}

			if( vdest_cbox_checked_count === 0 ) $_vdest_btn_selected_hide();
			else $_vdest_btn_selected_show();

			return false;
		}).mouseenter(function()
		{
			vdest_btn_mouseenter( $(this), "Click to select '" + $(this).parent().data("name_of") + "'.");
		}).mouseleave(function()
		{
			vdest_btn_mouseleave( $(this), "Click to select an input source for '" + $(this).parent().data("name_of") + "'.");
			// DO NOT: return false; the mouseleave needs to bubble up
		});

		vdest_effect_set($_vdestinations[dx], "vdest-effect-none");

	}//for dx

	$_vdest_cntnr.find( ".vdest-btn-info" ).click( function()                                       /************* HELP BUTTON ************/
	{
		if( vsource_is_showing || numpad_is_showing )
			return false;
		return false;
	} ).mouseenter( function()
	{
		vdest_btn_mouseenter( $(this), "Click to get help information." );
		return false;
	}).mouseleave( function()
	{
		vdest_btn_mouseleave( $(this), null );
		return false;
	} ).mousedown( function()
	{
		vdest_btn_mousedown( $(this) );
		return false;
	} ).mouseup( function()
	{
		vdest_btn_mouseup( $(this) );
		return false;
	} );

	$_vdest_cntnr.find( ".vdest-btn-default" ).click( function()                                       /************* DEFAULT I/O MAPPING BUTTON ************/
	{
		if( vsource_is_showing || numpad_is_showing )
			return false;
		setup_default();
		return false;
	} ).mouseenter( function()
	{
		vdest_btn_mouseenter( $(this), "Click to set up the default input-output mappings." );
		return false;
	}).mouseleave( function()
	{
		vdest_btn_mouseleave( $(this), null );
		return false;
	} ).mousedown( function()
	{
		vdest_btn_mousedown( $(this) );
		return false;
	} ).mouseup( function()
	{
		vdest_btn_mouseup( $(this) );
		return false;
	} );

	$_vdest_cntnr.find( ".vdest-btn-numpad" ).click( function()                                       /************* CHANGE CHANNEL POPUP BUTTON ************/
	{
		if( vsource_is_showing || numpad_is_showing )
			return false;
		numpad_show( true, true );
		numpad_is_showing = true;
		vdest_effect_set( $(this), "vdest-effect-none" );
		status_set( "Enter in the channel number for the TV source." );
		return false;
	} ).mouseenter( function()
	{
		vdest_btn_mouseenter( $(this), "Click to change the channel of a connected TV source." );
		return false;
	}).mouseleave( function()
	{
		vdest_btn_mouseleave( $(this), null );
		return false;
	} ).mousedown( function()
	{
		vdest_btn_mousedown( $(this) );
		return false;
	} ).mouseup( function()
	{
		vdest_btn_mouseup( $(this) );
		return false;
	} );

	$_vdest_btn_clearall.click( function()                                                      /************* CLEAR ALL CHECKED BOXES BUTTON ************/
	{
		if( vsource_is_showing || numpad_is_showing )
			return false;
		for( var dx = 0; dx < $_vdestinations.length; dx++ )
		{
			vdest_cbox_uncheck( $_vdestinations[dx], null );
		}
		$_vdest_btn_selected_hide();
		return false;
	} ).mouseenter( function()
	{
		vdest_btn_mouseenter( $(this), "Click to un-select all the output devices." );
		return false;
	}).mouseleave( function()
	{
		vdest_btn_mouseleave( $(this), null );
		return false;
	} ).mousedown( function()
	{
		vdest_btn_mousedown( $(this) );
		return false;
	} ).mouseup( function()
	{
		vdest_btn_mouseup( $(this) );
		return false;
	}).hide();

	$_vdest_btn_selected.click( function()                                                   /************* CHECKED BOXES SELECTION BUTTON ************/
	{
		if( vsource_is_showing || numpad_is_showing )
			return false;
		source_selection_show();
		status_set( "Click to select an input source for the checked devices." );
		return false;
	} ).mouseenter( function()
	{
		vdest_btn_mouseenter( $(this), "Click to select an input source for the checked devices." );
		return false;
	} ).mouseleave( function()
	{
		vdest_btn_mouseleave( $(this), null );
		return false;
	} ).mousedown( function()
	{
		vdest_btn_mousedown( $(this) );
		return false;
	} ).mouseup( function()
	{
		vdest_btn_mouseup( $(this) );
		return false;
	} ).hide();


	/*************************************************************
	 *************************************************************	D I V    I C O N    S I Z I N G
	 *************************************************************/


		// Set the source and destination elements size and location - on init and on screen-resize
	function resize()
	{
		var ratio_tv = 499.0/296.0; // from the dimensions of the tv bkgd images
		var ratio_page = (16.0/9.0) - 0.054/*adjust until the bkgd image fits nicely in the otf-container-destinations bkg-size'd as "contain", then set the div bkg-size to 100%*/;
		var dx;
		var height_minimum = os1_nav_is_mobile ? 192 : 384;
		var pup_scalefactor = 0.75;
		
		var $_body = $( "body" );
		height_body = $_body.height();
		width_body  = $_body.width();

		var $_cntnr_outer = $( "#vdest-cntnr-outer" );
		var $_cntnr_header = $( "#vdest-cntnr-header" );
		var $_header_img = $_cntnr_outer.find( ".header-img" );

			// force the orientation to 16:9 mode landscape
		var height_outer;
		var width_outer;
		if( (height_body * ratio_page) > width_body ) // portrait or taller: fit to body width, run short in the height
		{
			width_outer = width_body * 0.95;
			height_outer = width_outer / ratio_page;
		} else // landscape or wider: fit to body height, run short in the width
		{
			height_outer = height_body * 0.95;
			width_outer =  height_outer * ratio_page;
		}
		if( height_outer < height_minimum ) // minimum size restriction
		{
			height_outer = height_minimum;
			width_outer =  height_outer * ratio_page;

				// Remove some functionality on small devices
			if( os1_nav_is_mobile )
			{
				for( dx = 0; dx < $_vdestinations.length; dx++ )
				{
					$_vdestinations[dx].find( ".vdest-tvbtn-power" ).hide();
					$_vdestinations[dx].find( ".vdest-tvbtn-cbox" ).hide();
				}

					// Shrink the header and remove its image
				$_cntnr_header.height( 1 );
				$_header_img.hide();
				pup_scalefactor = 1.0;
			}
		}
		$_cntnr_outer.height( height_outer );
		$_cntnr_outer.width( width_outer );

		oheight_header = $_cntnr_header.outerHeight( true );
		oheight_footer = $( "#vdest-cntnr-footer" ).outerHeight( true );

		width_header_div = $_cntnr_header.width();
		var px_borderpadding = ($_cntnr_header.outerWidth() - width_header_div); // width of border and padding, both sides

			// size and position the header image - it is absolutely positioned so the graphic can extend outside the header div
		var doc_posn_header = $_cntnr_header.offset(); // get the absolute position of the header div
		doc_posn_header.left += (width_header_div * 0.03); // offset it a bit based upon the size of the header div (positions it relative to the header div)
		doc_posn_header.top += (oheight_header * 0.11);
		$_header_img.width( width_header_div * 0.95).offset( doc_posn_header );

		// Compute and set the inner height of the destination div...
		var height_other = oheight_header + oheight_footer + px_borderpadding;
		var height_dest_div = height_outer - height_other;

		$_vdest_cntnr.height( height_dest_div );
		$_vdest_cntnr.width( width_header_div );

		// Compute the output (destination) icon size
		var height_icon = height_dest_div * 0.21/*whatever works*/;
		var width_icon =  height_icon * ratio_tv;

		for( dx = 0; dx < 6; dx++ ) // All the tv icons are the same size
		{
			$_vdestinations[dx].height( height_icon );
			$_vdestinations[dx].width( width_icon );

				// size the connected_to div square based on the tv icon height
			var dimen = height_icon * 0.70;
			$_vdestinations[dx].find( ".vdest-connto" ).width( dimen ).height( dimen );
		}
		for( dx = 6; dx < $_vdestinations.length; dx++ ) // Non-tv icons
		{
			$_vdestinations[dx].height(height_icon);
			$_vdestinations[dx].width(width_icon);

			dimen = height_icon * 0.65;
			$_vdestinations[dx].find( ".vdest-connto" ).width( dimen ).height( dimen );
		}

			// Compute and set the size of the source input pop-up - it will be contained within the dest div

		var posn_dest = $_vdest_cntnr.offset();
		vsources_size_set ( height_dest_div * pup_scalefactor );
		vsources_position_center( posn_dest.top, 0, height_dest_div, width_body );

			// Make the numpad the same height as the source popup
		numpad_size_set ( height_dest_div * pup_scalefactor );
		numpad_position_center ( posn_dest.top, 0, height_dest_div, width_body );

		// Scale text elements as well
		$_vdest_cntnr.find( ".vdest-btn-cntnr" ).find( ".varitext-btn" ).css( "font-size", height_dest_div * 0.030 );
		$_vdest_btn_selected.find( ".vdest-btn-selected-devices" ).css( "font-size", height_dest_div * 0.024 );
		$( el_status ).css( "font-size", height_dest_div * 0.033 );

	}//size_n_posn

	resize();

	$( window ).resize( function()
	{
		resize();
	});

	function setup_default()
	{
		source_destination_connection_set( vsources_$_hevs1(), $_vdestinations[0] );
		device_control_switch( vsources_$_hevs1(), $_vdestinations[0] );

		source_destination_connection_set( vsources_$_hevs2(), $_vdestinations[1] );
		device_control_switch( vsources_$_hevs2(), $_vdestinations[1] );

		source_destination_connection_set( vsources_$_hevs3(), $_vdestinations[2] );
		device_control_switch( vsources_$_hevs3(), $_vdestinations[2] );

		source_destination_connection_set( vsources_$_hevs1(), $_vdestinations[3] );
		device_control_switch( vsources_$_hevs1(), $_vdestinations[3] );

		source_destination_connection_set( vsources_$_hevs2(), $_vdestinations[4] );
		device_control_switch( vsources_$_hevs2(), $_vdestinations[4] );

		source_destination_connection_set( vsources_$_tv(), $_vdestinations[5] );
		device_control_switch( vsources_$_tv(), $_vdestinations[5] );
	}

	setup_default();



	/*************************************************************
	 *************************************************************	D E V I C E   C O N T R O L
	 *************************************************************/


	function json_parms_build( script_name, parms_ary )
	{
		var parm_str = "";
		if( parms_ary )
		{
			for( var px = 0; px < parms_ary.length; px++ )
				parm_str += ', "' + parms_ary[px] + '"';
		}
		return '"C:\\\\vaderScripts\\\\' + script_name + '"' + parm_str;
	}

	function json_build( parm_str )
	{
		return '{"jsonrpc": "2.0", "method": "Addons.ExecuteAddon", "params": { "wait": true, "addonid": "script.executor", "params": [ ' + parm_str + ' ]}, "id": 0}';
	}


	function device_control_power( $_output )
	{
		var parm = json_parms_build( "serial-POWER.py", [$_output.data( "output" )] );
		var json_bs = json_build( parm );
		//xbmc.sendCommand( json_bs );
alert( json_bs );
		status_set( "Power toggled for output device '" + $_output.data( "name_of" )  + "'." );
status_set( parm );
	}

	function device_control_mute( $_output )
	{
		var parm = json_parms_build( "serial-volumeMUTE.py", [$_output.data( "output" )] );
		var json_bs = json_build( parm );
		//xbmc.sendCommand( json_bs );
alert( json_bs );
		status_set( "Mute toggled for output device '" + $_output.data( "name_of" )  + "'." );
status_set( parm );
	}

	function device_control_volume( $_output, level )
	{
		if( level > 0 )
			var parm = json_parms_build( "serial-volumeUP.py", [$_output.data( "output" )] );
		else parm = json_parms_build( "serial-volumeDOWN.py", [$_output.data( "output" )] );
		var json_bs = json_build( parm );
		//xbmc.sendCommand( json_bs );
alert( json_bs );
		status_set( "Volume " + ((level>0) ? "UP" : "DOWN") + " for output device '" + $_output.data( "name_of" )  + "'." );
status_set( parm );
	}

	function device_control_switch( $_input, $_output )
	{
		var parm = json_parms_build( "single_output.py", [$_input.data( "input" ), $_output.data( "output" )] );
		var json_bs = json_build( parm );
		//xbmc.sendCommand( json_bs );
status_set( parm );
	}


	function device_control_all( $_input )
	{
		var parm = json_parms_build( "all_outputs.py", [$_input.data( "input" )] );
		var json_bs = json_build( parm );
		//xbmc.sendCommand( json_bs );
alert( json_bs );
status_set( parm );
	}


	function device_control_tv_channel_set( channum )
	{
		var parm = json_parms_build( "serial-CHANNEL.py", [vsources_$_tv().data( "input" ), channum] );
		var json_bs = json_build( parm );
		//xbmc.sendCommand( json_bs );
		status_set( "TV channel set to '" + channum + "' for input device '" + vsources_$_tv().data( "name_of" )  + "'." );
alert( json_bs );
status_set( parm );
	}

	function device_control_tv_channel_bump( nchan )
	{
		if( nchan > 0 )
			var parm = json_parms_build( "serial-CHANNELUP.py", [vsources_$_tv().data( "input" )] );
		else parm = json_parms_build( "serial-CHANNELDOWN.py", [vsources_$_tv().data( "input" )] );
		var json_bs = json_build( parm );
		//xbmc.sendCommand( json_bs );
		status_set( "TV channel bumped " + ((nchan>0) ? "UP" : "DOWN") + " for input device '" + vsources_$_tv().data( "name_of" )  + "'." );
alert( json_bs );
status_set( parm );
	}

		// Get input/output mappings
	setInterval(function()
	{
	/*	$.getJSON( "localhost:8000/io_status.apsx", function( mappings )
		{
			alert( mappings );
		} );*/
	}, 60000);


	status_set( null );

});
</script>


</body>
</html>

